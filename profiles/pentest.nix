# Pentest VM - Full profile
# Used for both:
#   1. Building VM images (nix build '.#pentest')
#   2. Rebuilding inside VMs (nixos-rebuild switch --flake '.#vm-pentest')
#
# Hostname customization:
#   - Default: "pentest-vm"
#   - Override: Create local/vm-instance.nix with: { hostname = "pentest-myname"; }
#   - The build-vm.sh script generates this automatically
#
{ config, pkgs, lib, modulesPath, ... }:

{
  imports = [
    # Hydrix options - MUST BE FIRST to define hydrix.* options before other modules use them
    ../modules/base/hydrix-options.nix

    # VM base module - handles all common VM config (hardware, locale, etc.)
    ../modules/vm/vm-base.nix

    # Pentest-specific modules
    ../modules/pentesting/hosts.nix       # CTF/HTB host mappings
    ../modules/pentesting/proxychains.nix # Declarative proxy configuration
    ../modules/pentesting/pentesting.nix  # Full pentesting toolkit
  ];

  # VM identity
  hydrix.vmType = "pentest";
  hydrix.colorscheme = "nvid";
  hydrix.vm.defaultHostname = "pentest-vm";
}

# Pentest VM - Minimal base image
# This is the small image that gets built once
# VM will shape itself on first boot
{ config, pkgs, lib, ... }:

{
  # Allow unfree firmware for hardware support
  nixpkgs.config.allowUnfree = true;

  imports = [
    ../modules/base/nixos-base.nix
    ../modules/base/users.nix
    ../modules/base/networking.nix
    ../modules/vm/qemu-guest.nix
    ../modules/vm/hydrix-clone.nix
    ../modules/vm/hardware-setup.nix
    ../modules/vm/shaping.nix
  ];

  # Hostname - will be used by shaping service to detect VM type
  networking.hostName = lib.mkForce "pentest-vm";

  # Minimal packages for bootstrapping
  environment.systemPackages = with pkgs; [
    git
    vim
    wget
    curl
    htop
    nixos-rebuild
    sudo
  ];

  # Boot and filesystem config handled by nixos-generators format
}

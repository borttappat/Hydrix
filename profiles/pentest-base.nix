# Pentest VM - Minimal base image
# This is the small image that gets built once
# VM will shape itself on first boot
{ config, pkgs, lib, ... }:

{
  # Allow unfree firmware for hardware support
  nixpkgs.config.allowUnfree = true;

  imports = [
    ../modules/base/nixos-base.nix
    ../modules/base/users.nix
    ../modules/base/networking.nix
    ../modules/vm/qemu-guest.nix
    ../modules/vm/shaping.nix
  ];

  # Hostname - override default from networking.nix
  networking.hostName = lib.mkForce "pentest-base";

  # Minimal packages for bootstrapping
  environment.systemPackages = with pkgs; [
    git
    vim
    wget
    curl
    htop
  ];

  # Boot and filesystem config handled by nixos-generators format
}

# Pentest VM - Minimal base image
# This is the small image that gets built once
# VM will shape itself on first boot
{ config, pkgs, lib, ... }:

{
  imports = [
    ../modules/base/nixos-base.nix
    ../modules/base/users.nix
    ../modules/base/networking.nix
    ../modules/vm/qemu-guest.nix
    ../modules/vm/shaping.nix
  ];

  # Hostname
  networking.hostName = "pentest-base";

  # Minimal packages for bootstrapping
  environment.systemPackages = with pkgs; [
    git
    vim
    wget
    curl
    htop
  ];

  # Boot config for VM
  boot.loader.grub = {
    enable = true;
    device = "/dev/vda";
  };

  # Minimal filesystem
  fileSystems."/" = {
    device = "/dev/vda1";
    fsType = "ext4";
  };
}
